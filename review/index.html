<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVMeme Exam</title>
    <style>
        :root {
            --primary: #bbe1ee;
            --secondary: #393e46;
            --accent: #ffffff;
            --bg: #ffffff;
            --card-bg: rgba(20, 20, 20, 0.95); /* Darker for better text readability */
        }

        body {
            margin: 0;
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            user-select: none;
        }

        header {
            text-align: center;
            z-index: 10;
            margin-top: 20px;
            pointer-events: none;
            height: 15vh;
        }

        .logo {
            max-width: 250px;
            height: auto;
            display: block;
            margin: 0 auto 5px auto;
            filter: drop-shadow(0 0 10px rgba(78, 204, 163, 0.5));
        }

        p.subtitle { color: #ccc; font-style: italic; margin-top: 0; font-size: 0.9rem; }

        /* SCENE (Drag Area) */
        .scene {
            position: relative;
            width: 100%;
            height: 45vh; /* Reduced slightly to give more room to card */
            perspective: 1000px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
            touch-action: none;
        }
        .scene:active { cursor: grabbing; }

        .orbit {
            position: absolute;
            width: 600px;
            height: 300px;
            transform-style: preserve-3d;
        }

        .item {
            position: absolute;
            width: 140px;
            height: 90px;
            background: #000;
            border: 2px solid var(--secondary);
            box-shadow: 0 0 10px rgba(0,0,0,0.8);
            border-radius: 10px;
            left: 50%;
            top: 50%;
            margin-left: -70px;
            margin-top: -45px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.5;
            background-size: cover;
            background-position: center;
        }

        .item.active {
            border-color: var(--primary);
            box-shadow: 0 0 30px var(--primary);
            opacity: 1;
            z-index: 100;
            transform: scale(1.3) !important;
        }

        .item-label {
            position: absolute;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            width: 100%;
            text-align: center;
            font-size: 0.7rem;
            padding: 4px 0;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* MEME CARD CONTAINER */
        .meme-card-container {
            flex-grow: 1;
            width: 90%;
            max-width: 1000px;
            background: var(--card-bg);
            border-top: 3px solid var(--primary);
            padding: 20px;
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
            overflow: hidden; /* Prevent spillover */
        }

        /* Left Side: Video/Image */
        .video-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }
        
        .video-placeholder {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 1px solid #444;
        }
        .video-placeholder img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .play-overlay {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            font-size: 3rem; color: white; text-shadow: 0 0 10px black; cursor: pointer;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.8rem;
            color: #aaa;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
        }
        .meta-item strong { color: var(--primary); display: block; }
        .meta-full { grid-column: span 2; }

        /* Right Side: Info & Question */
        .info-panel {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow scrolling for long choices */
            padding-right: 10px;
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar { width: 8px; }
        .info-panel::-webkit-scrollbar-track { background: #111; }
        .info-panel::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        
        h2 { margin: 0; font-size: 1.5rem; color: white; }
        .year-tag { font-family: monospace; color: var(--accent); font-size: 1.2rem; font-weight: bold; }

        .tags-row { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .badge.cat { background: var(--primary); color: black; }
        .badge.emo { background: #555; color: white; border: 1px solid #777; }
        .badge.sens { background: var(--accent); color: white; }

        .description-text {
            font-size: 0.9rem; color: #ccc; margin-bottom: 15px; line-height: 1.4;
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px;
        }

        /* Question Area */
        .question-area {
            background: rgba(0,0,0,0.4);
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
        }
        
        .q-type { color: var(--primary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .q-text { font-size: 1.05rem; font-weight: bold; margin-bottom: 10px; display: block; }
        
        .choices-list { list-style: none; padding: 0; margin: 0; }
        .choices-list li {
            padding: 6px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.95rem;
            color: #ddd;
        }
        .choices-list li:hover { background: rgba(255,255,255,0.05); }
        .choices-list li span.opt-letter { color: var(--primary); font-weight: bold; margin-right: 8px; }

        .nav-cue { position: absolute; top: 50%; font-size: 2rem; color: rgba(255,255,255,0.2); pointer-events: none; }
        .nav-cue.left { left: 20px; }
        .nav-cue.right { right: 20px; }

    </style>
</head>
<body>

    <header>
        <img src="../image/logo.png" alt="AVMeme Exam Logo" class="logo">
        <p class="subtitle">Drag to rotate</p>
    </header>

    <div class="scene" id="scene">
        <div class="orbit" id="orbit"></div>
        <div class="nav-cue left">❮</div>
        <div class="nav-cue right">❯</div>
    </div>

    <div class="meme-card-container" id="cardContainer">
        
        <div class="video-column">
            <div class="video-placeholder">
                <img id="cardImage" src="" alt="Meme Preview">
                <div class="play-overlay">▶</div>
            </div>
            
            <div class="metadata-grid">
                <div class="meta-item"><strong>Language</strong><span id="metaLang">en</span></div>
                <div class="meta-item"><strong>Sensitivity</strong><span id="metaSens">None</span></div>
                <div class="meta-item meta-full"><strong>Transcript</strong><span id="metaTrans" style="font-style: italic; color: #888;">N/A</span></div>
            </div>
        </div>

        <div class="info-panel">
            <div class="header-row">
                <h2 id="cardTitle">Title</h2>
                <span class="year-tag" id="cardYear">2020</span>
            </div>

            <div class="tags-row">
                <span id="cardCategory" class="badge cat">Category</span>
                <span id="cardEmotion" class="badge emo">Emotion</span>
            </div>

            <div class="description-text">
                <strong style="color:white;">Summary:</strong> <span id="cardSummary">...</span><br>
                <strong style="color:white; display:block; margin-top:5px;">Usage:</strong> <span id="cardUsage">...</span>
            </div>

            <div class="question-area">
                <div class="q-type" id="cardQType">Question Type</div>
                <span class="q-text" id="cardQuestion">Question goes here?</span>
                <ul class="choices-list" id="cardOptions">
                    </ul>
            </div>
        </div>
    </div>
    <script>
        // --- DATA FROM PAPER (APPENDIX D) ---
        const memes = [
            { 
                id: 1, 
                title: "Never Gonna Give You Up", 
                year: "1987", 
                category: "Song", 
                emotion: "surprised/shocked, nostalgic", 
                lang: "English",
                sensitivity: "None",
                transcription: "N/A",
                summary: "The start of music video 'Never Gonna Give You Up'.",
                usage: "A bait and switch is usually done using a disguised hyperlink leading to this music video.", 
                qType: "Humor & Popularity", 
                question: "What is the top reason this song became so popular as a meme?", 
                options: [
                    "A. Unexpected appearance on the Internet.", 
                    "B. Often got edited and remixed for parody.",
                    "C. A lot of references from other songs and movies.",
                    "D. The singer has sung it a lot.",
                    "E. It became a sports anthem.",
                    "F. It is popularized from forums such as 4chan and reddit."
                ], 
                src: "https://placehold.co/400x300/1a1a1a/FFF?text=Rick+Roll" 
            },
            { 
                id: 2, 
                title: "You Shall Not Pass", 
                year: "2001", 
                category: "Noisy Speech", 
                emotion: "fearful/anxious", 
                lang: "English",
                sensitivity: "violence/gore",
                transcription: "You shall not pass.",
                summary: "A powerful wizard confronts a fiery monster on a narrow bridge, striking his staff and shouting defiantly.",
                usage: "Used to jokingly or seriously deny someone access or prevent them from proceeding.", 
                qType: "Usage & Application", 
                question: "Which of the following is a humorous way a college student might use this meme?", 
                options: [
                    "A. When talking about the spread of the flu among students.",
                    "B. When discussing how difficult the final exam was in a class.",
                    "C. When presenting a final project in an art class.",
                    "D. When asking the professor a question during a lecture."
                ], 
                src: "https://placehold.co/400x300/331111/FFF?text=Gandalf" 
            },
            { 
                id: 3, 
                title: "GTA Wasted", 
                year: "2013", 
                category: "Sound Effect", 
                emotion: "neutral", 
                lang: "N/A",
                sensitivity: "None",
                transcription: "N/A",
                summary: "The game over sound effect in Grand Theft Auto.",
                usage: "Used when someone fails something.", 
                qType: "World Knowledge", 
                question: "Where will you likely be after you hear this sound?", 
                options: [
                    "A. Home.",
                    "B. Hospital.",
                    "C. Police office.",
                    "D. Jail.",
                    "E. Another world.",
                    "F. Flight landing."
                ], 
                src: "https://placehold.co/400x300/444444/FF0000?text=WASTED" 
            },
            { 
                id: 4, 
                title: "Duang (Shampoo Ad)", 
                year: "2004", 
                category: "Noisy Speech", 
                emotion: "neutral", 
                lang: "Chinese",
                sensitivity: "None",
                transcription: "(Actor discussing refusal to use special effects for hair)",
                summary: "An actor says he first refused to shoot the shampoo ad... special effects 'Duang'...",
                usage: "'Duang' is often used for a flashy, sudden, over-the-top sound or visual effect.", 
                qType: "Usage & Application", 
                question: "Which one of the following is the least suitable to be described by the onomatopoeic word in this clip?", 
                options: [
                    "A. Luxury race car.",
                    "B. Silky-shiny hair.",
                    "C. Dramatic sea view.",
                    "D. New game with good visuals."
                ], 
                src: "https://placehold.co/400x300/113311/FFF?text=Jackie+Chan" 
            },
            { 
                id: 5, 
                title: "I Don't Like Sand", 
                year: "2002", 
                category: "Noisy Speech", 
                emotion: "cringe/embarrassed", 
                lang: "English",
                sensitivity: "None",
                transcription: "I don't like sand.",
                summary: "Anakin Skywalker, in an awkward attempt at flirting, complains about sand.",
                usage: "Used to mock awkward dialogue or complain about minor inconveniences.", 
                qType: "Contextual Inference", 
                question: "What is the speaker's primary motivation for making this comment about sand?", 
                options: [
                    "A. To provide a detailed geological analysis.",
                    "B. To share a fond childhood memory.",
                    "C. As an awkward attempt to compliment his companion.",
                    "D. To change the subject to his favorite topic, desert planets."
                ], 
                src: "https://placehold.co/400x300/887755/FFF?text=Sand" 
            },
            { 
                id: 6, 
                title: "Kazoo Cover (Shooting Stars)", 
                year: "2010", 
                category: "Music", 
                emotion: "sarcastic/ironic", 
                lang: "N/A",
                sensitivity: "None",
                transcription: "N/A",
                summary: "A short instrumental break mixing distorted guitar and kazoo.",
                usage: "Used to express absurd humor, irony, or mock-solemn moments.", 
                qType: "World Knowledge", 
                question: "What type of character or figure would most likely appear when this distinctive instrumental interlude plays?", 
                options: [
                    "A. A cartoon superhero saving the world in slow motion with exaggerated seriousness.",
                    "B. A middle-aged man performing mundane tasks.",
                    "C. A young couple celebrating a wedding under bright fireworks.",
                    "D. A musician playing a kazoo with a jazz song."
                ], 
                src: "https://placehold.co/400x300/222222/FFF?text=Kazoo+Kid" 
            },
            { 
                id: 7, 
                title: "Windows Error", 
                year: "2001", 
                category: "Sound Effect", 
                emotion: "angry/annoyed", 
                lang: "N/A",
                sensitivity: "None",
                transcription: "N/A",
                summary: "Infinite pop-up errors in Windows.",
                usage: "The sound effect of the error is widely recognized and used for comic 'fail' beats.", 
                qType: "World Knowledge", 
                question: "Which operating system makes this sound?", 
                options: [
                    "A. Windows",
                    "B. macOS",
                    "C. Linux",
                    "D. Android",
                    "E. iOS"
                ], 
                src: "https://placehold.co/400x300/0000AA/FFF?text=XP+Error" 
            },
            { 
                id: 8, 
                title: "Look at all those chickens", 
                year: "2013", 
                category: "Clean Speech", 
                emotion: "happy, surprised", 
                lang: "English",
                sensitivity: "None",
                transcription: "Look at all those chickens",
                summary: "A young girl, awestruck, looking at a flock of what are actually geese or ducks.",
                usage: "Used to express excitement or amazement at a large number of things, often misidentifying them.", 
                qType: "Contextual Inference", 
                question: "What is the most likely reason for the person's exclamation?", 
                options: [
                    "A. She is scared of the animals.",
                    "B. She is excited and misidentifying the animals.",
                    "C. She is angry at the animals for making a mess.",
                    "D. She is trying to sell the animals."
                ], 
                src: "https://placehold.co/400x300/443311/FFF?text=Chickens" 
            }
        ];

        // --- 3D ENGINE ---
        const radiusX = 450;
        const radiusZ = 200;
        const itemAngleStep = 360 / memes.length;
        
        let currentAngle = 90; 
        let isDragging = false;
        let isSpinning = true; // Flag for intro animation
        let startX = 0;
        let lastX = 0;
        let velocity = 0;

        const orbit = document.getElementById('orbit');
        const scene = document.getElementById('scene');
        const cardContainer = document.getElementById('cardContainer');

        function init() {
            // Render Items
            memes.forEach((meme, index) => {
                const el = document.createElement('div');
                el.className = 'item';
                el.style.backgroundImage = `url('${meme.src}')`;
                el.innerHTML = `<div class="item-label">${meme.title}</div>`;
                const initialTheta = index * itemAngleStep;
                el.dataset.baseTheta = initialTheta; 
                orbit.appendChild(el);
            });

            orbit.style.transform = "rotateX(-10deg)";
            
            // --- SPIN WHEEL LOGIC ---
            // 1. Pick a random winner
            const randomIndex = Math.floor(Math.random() * memes.length);
            
            // 2. Calculate final angle
            // We want baseTheta + finalAngle = 90 (which is the "Front" position)
            // So: finalAngle = 90 - baseTheta
            // We subtract 360 * 5 to add 5 full spins (rotating clockwise visually)
            const targetTheta = randomIndex * itemAngleStep;
            const stopAngle = 90 - targetTheta - (360 * 4);
            
            // 3. Start Intro Animation
            animateSpin(90, stopAngle, 3000); // 3 seconds duration
        }

        function animateSpin(start, end, duration) {
            let startTime = null;

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Ease Out Cubic function: starts fast, slows down smoothly
                const ease = 1 - Math.pow(1 - progress, 3);
                
                currentAngle = start + (end - start) * ease;
                updateRender(); // Render frame

                if (progress < 1) {
                    requestAnimationFrame(step);
                } else {
                    // Animation Complete
                    isSpinning = false;
                    currentAngle = end; // Snap to exact value
                    findActiveItem();   // Ensure card is updated
                    loop();             // Handover to standard physics loop
                }
            }
            requestAnimationFrame(step);
        }

        // Standard Physics Loop (runs after intro)
        function loop() {
            if (!isSpinning && !isDragging) {
                velocity *= 0.95; // Friction
                currentAngle += velocity;
                
                // Snapping Logic when slow
                if (Math.abs(velocity) < 0.1) {
                    const snapTarget = Math.round((currentAngle - 90) / itemAngleStep) * itemAngleStep + 90;
                    currentAngle += (snapTarget - currentAngle) * 0.1;
                    if(Math.abs(snapTarget - currentAngle) < 0.01) {
                        currentAngle = snapTarget;
                        findActiveItem();
                    }
                }
            }
            updateRender();
            requestAnimationFrame(loop);
        }

        function updateRender() {
            const items = document.querySelectorAll('.item');
            items.forEach((item, index) => {
                const baseTheta = parseFloat(item.dataset.baseTheta);
                const theta = baseTheta + currentAngle;
                const rad = theta * (Math.PI / 180);
                const x = radiusX * Math.cos(rad);
                const z = radiusZ * Math.sin(rad);
                const scale = 0.6 + (0.4 * (z + radiusZ) / (2 * radiusZ));
                const opacity = 0.4 + (0.6 * (z + radiusZ) / (2 * radiusZ));

                item.style.transform = `translate3d(${x}px, 0, ${z}px) scale(${scale})`;
                item.style.zIndex = Math.floor(z + radiusZ);
                item.style.opacity = opacity;

                let normTheta = theta % 360;
                if(normTheta < 0) normTheta += 360;
                
                // Active range (Front)
                if (normTheta > 80 && normTheta < 100) {
                    if (!item.classList.contains('active')) {
                        item.classList.add('active');
                        // During spin, update card only if we are near the end (slow) to avoid flashing
                        // Or if not spinning
                        if(!isSpinning || Math.abs(velocity) < 2) {
                             updateCard(index);
                        }
                    }
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        function updateCard(index) {
            const data = memes[index];
            if (!data) return;
            
            document.getElementById('cardTitle').innerText = data.title;
            document.getElementById('cardYear').innerText = data.year;
            document.getElementById('cardCategory').innerText = data.category;
            document.getElementById('cardEmotion').innerText = data.emotion;
            document.getElementById('cardSummary').innerText = data.summary;
            document.getElementById('cardUsage').innerText = data.usage;
            document.getElementById('cardQType').innerText = data.qType;
            document.getElementById('cardQuestion').innerText = data.question;
            document.getElementById('cardImage').src = data.src;

            document.getElementById('metaLang').innerText = ": " + data.lang;
            const sensEl = document.getElementById('metaSens');
            sensEl.innerText = ": " + data.sensitivity;
            document.getElementById('metaTrans').innerText = ": " + (data.transcription.length > 50 ? data.transcription.substring(0,50) + "..." : data.transcription);
            
            const ul = document.getElementById('cardOptions');
            ul.innerHTML = '';
            data.options.forEach(opt => {
                const li = document.createElement('li');
                const letter = opt.split('.')[0]; 
                const text = opt.substring(letter.length + 1);
                li.innerHTML = `<span class="opt-letter">${letter}.</span>${text}`;
                ul.appendChild(li);
            });
        }
        
        function findActiveItem() {
            const items = document.querySelectorAll('.item');
            items.forEach((item, index) => {
                if(item.classList.contains('active')) updateCard(index);
            });
        }

        // --- DRAG EVENTS ---
        function startDrag(e) {
            if (isSpinning) return; // Disable drag during intro
            isDragging = true;
            startX = e.pageX || e.touches[0].pageX;
            lastX = startX;
            velocity = 0;
            cardContainer.style.opacity = "0.7";
        }

        function moveDrag(e) {
            if (!isDragging) return;
            const clientX = e.pageX || e.touches[0].pageX;
            const deltaX = clientX - lastX;
            lastX = clientX;
            currentAngle += deltaX * 0.3; 
            velocity = deltaX * 0.3;
        }

        function endDrag() {
            if (isSpinning) return;
            isDragging = false;
            cardContainer.style.opacity = "1";
        }

        scene.addEventListener('mousedown', startDrag);
        window.addEventListener('mousemove', moveDrag);
        window.addEventListener('mouseup', endDrag);
        scene.addEventListener('touchstart', startDrag);
        window.addEventListener('touchmove', moveDrag);
        window.addEventListener('touchend', endDrag);
        
        document.addEventListener('keydown', (e) => {
            if (isSpinning) return;
            if(e.key === "ArrowLeft") velocity += 3;
            if(e.key === "ArrowRight") velocity -= 3;
        });

        init();
    </script>

</body>
</html>